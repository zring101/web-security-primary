# 越权

# 简介

![%E8%B6%8A%E6%9D%83%2043b0e0ac79644272866b5d66b6f21c93/Untitled.png](%E8%B6%8A%E6%9D%83%2043b0e0ac79644272866b5d66b6f21c93/Untitled.png)

如上图所示，insecure-website.com存在多个接口，通过观察不难发现，/admin是管理员界面，/ab12345是用户ab12345的用户界面。这里可以引出两个问题：

1、如果普通用户在登陆后直接访问/admin接口，能否访问到管理员界面的内容？

2、如果普通用户ab12345直接访问/cd12345，能否访问到用户cd12345的账户内容？

如果1成功，可以被称为垂直越权（权限级别提升）；如果2成功，可以被称为水平越权（权限级别不变）。

---

# 原理

正如手册开头介绍的，「对于普通站点而言，所有的输入流均来自不可信的用户，你永远无法预测用户的输入（即便是网站本身的参数也可以被用户恶意修改）」。

越权不是一种攻击方式，而是一种攻击结果。后端信任了前端传入的某些参数，普通用户可以通过修改参数超越合理使用范围。（查看其他用户、查看管理员、伪装其他用户提交请求、伪装管理员执行指令）

---

# 技巧

**水平越权**

#一切都建立在你可以预测有效的相关参数的基础上，这些参数可能存在一定的规律或者相同的编码规则

修改用户名参数：如UMID、用户数字ID

修改订单参数：如订单号、保单号

...

**垂直越权**

站点存在管理员专属接口，如：reset_account接口，假设该接口请求数据包格式如下：

```bash
POST /reset_account HTTP 1.1
HOST: test.com
...
...
cookie: JSESSION:zzzzaaaacccc     【管理员的cookie为：zzzzaaaacccc】

{account: 'jack'}
```

该接口设计的目的是：提供管理员重置某账号的能力，普通用户界面不存在该接口按钮

但，如果普通用户通过构造请求数据包，构造出如上的请求，成功重置了jack账号，则存在垂直越权漏洞。【网站仅通过不同的前端展示来控制用户的访问范围，但是网站后端架构上并无任何权限控制，不存在基于身份—功能的访问控制】

```bash
POST /reset_account HTTP 1.1
HOST: test.com
...
...
cookie: JSESSION:ggggmmmmaaaa     【普通用户的cookie为：ggggmmmmaaaa】

{account: 'jack'}
```