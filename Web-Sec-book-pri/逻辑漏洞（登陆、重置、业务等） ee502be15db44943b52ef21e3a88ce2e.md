# 逻辑漏洞（登陆、重置、业务等）

> 逻辑漏洞中，最常见的一个标识就是非登陆请求包中包含用户的ID参数，比如username=xiaoming123或者umid=xiaoming123。因为在正常的架构设计中，cookie字段就是用户身份的唯一标识，如果后台对于身份进行鉴权不是基于cookie而是基于username或umid的，则很有可能存在逻辑漏洞。逻辑漏洞本身与计算机知识关联不大，更多在于能否发现显而易见的逻辑问题。

# 登陆

- 无验证码（此处无验证码指：无论输入多少次错误的账号密码均无验证码要求）
    - 账号密码爆破漏洞：使用爆破模块，根据状态码或返回包的长度或返回特征字符串，判断是否爆破成功
    - 账号枚举漏洞：针对有效账户的错误登陆与无效账户的错误登陆具有不同的返回包特征
- 有验证码
    - 逻辑漏洞1：验证码本身的字符串在返回包中明文显示
    - 逻辑漏洞2：验证码字段置空后，后台仅验证账号密码，不提示验证码错误等信息
- 双因素令牌
    - 逻辑漏洞：抓包发现存在提交账号密码的请求包1和提交令牌的请求包2，如果请求包2中不包含由返回包1（请求包1的返回包）携带的相关token，则可以认为仅请求包2是实际登陆请求包。那么双因素实际上就变为单因素。【标准设计为：账号、密码、令牌在一个请求包中】

---

# 重置密码

- 重置任意用户密码：重置密码时的请求包中包含用户ID，可被修改成其他用户ID并成功重置其他用户密码
- 逻辑漏洞1：校验旧密码是否正确时，后台不存在次数限制，可以通过爆破该接口获取有效密码
- 逻辑漏洞2：校验旧密码是否正确后，设置新密码的请求与校验旧密码请求不为同一个（与双因素令牌逻辑漏洞类似），且不存在前一步生成的token。

---

# 业务漏洞

### 频率

- 短信验证码接口不存在频率限制
- 营销活动中，短信转发好友接口不存在对象或频率限制
- 在线客服模块中，对客服发送消息不存在频率或文件大小限制（导致DDOS）

### 购买

- 商品数过大、为负数、为小数
- 商品单价过大、为负数
- 总价被修改后，与单价*数量不一致（小于、大于或为负数）
- 在涉及资金退还的请求包，send to repeater，重放数次，观察是否有多余金额退还

### 返回包

- 对于流程之间存在鉴权环节的，前端自动执行下一步的前提是返回包中包含某特征字符串（如：success，01，10000等）这可以通过修改返回包进行绕过。
- 正确流程应该为：
    - 第一步申请鉴权，后端保存鉴权成功/失败状态字段后，返回包含特征字符串的返回包。
    - 前端根据返回包特征，自动执行第二步，第二步的后端接口根据鉴权状态字段进行处理/不处理。